-- Case-1: Performing and Closure date before 20-AUG-2020

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'P'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_INTERNAL_ACNUM NOT IN (SELECT B.ACBLK_INTERNAL_ACNUM FROM BACKUPTABLE.COVID_DATA_INVALID@dr B)
       AND ACNTS_CLOSURE_DATE <'20-AUG-2020'
       UNION ALL
       SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA_1@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'P'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_CLOSURE_DATE <'20-AUG-2020';


-- Case-2: Non-Performing and Closure date before 20-AUG-2020

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'N'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_INTERNAL_ACNUM NOT IN (SELECT B.ACBLK_INTERNAL_ACNUM FROM BACKUPTABLE.COVID_DATA_INVALID@dr B)
       AND ACNTS_CLOSURE_DATE <'20-AUG-2020'
       UNION ALL
       SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA_1@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'N'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_CLOSURE_DATE <'20-AUG-2020';


-- Case-1: Non Performing and Closure date upto 03-mar-2021

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'N'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_INTERNAL_ACNUM NOT IN (SELECT B.ACBLK_INTERNAL_ACNUM FROM BACKUPTABLE.COVID_DATA_INVALID@dr B)
       AND ACNTS_CLOSURE_DATE <'03-MAR-2021'-- Reimbursement Voucher posted on
       AND ACNTS_CLOSURE_DATE > '20-AUG-2020'; --minmum date of acblkcovid implementation

-- Case-2: Performing and Closure date upto 03-mar-2021

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'P'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_INTERNAL_ACNUM NOT IN (SELECT B.ACBLK_INTERNAL_ACNUM FROM BACKUPTABLE.COVID_DATA_INVALID@dr B)
       AND ACNTS_CLOSURE_DATE <'03-MAR-2021'-- Reimbursement Voucher posted on
       AND ACNTS_CLOSURE_DATE > '20-AUG-2020'; --minmum date of acblkcovid implementation


-- Case-3: Non-Performing and Closure date upto 30-JUN-2021

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA_1@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'N'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_CLOSURE_DATE <'30-JUN-2021'-- Reimbursement Voucher posted on
       AND ACNTS_CLOSURE_DATE > '20-AUG-2020'; --minmum date of acblkcovid implementation


-- Case-4: Performing and Closure date upto 30-JUN-2021

SELECT IACLINK_BRN_CODE,
       ACC_NO,
       ACBLK_AMT_TRF_BLK_GL,
       ACBLK_AMT_RECOVERED,
       ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED BLOCK_AMOUNT,
       WAIVED_INTEREST_AMOUNT,
       ABS((ACBLK_AMT_TRF_BLK_GL - ACBLK_AMT_RECOVERED) - WAIVED_INTEREST_AMOUNT) TO_BE_RECOVERED
  FROM COVID_SBL_DATA_1@DR C,
       IACLINK@DR,
       ACBLKCOVID@DR,
       ACNTS@DR
 WHERE     IACLINK_ENTITY_NUM = 1
       AND IACLINK_ACTUAL_ACNUM = ACC_NO
       AND ACBLK_ENTITY_NUM = 1
       AND ACBLK_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACBLK_ASSET_TYPE = 'P'
       AND ACNTS_ENTITY_NUM = 1
       AND ACNTS_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
       AND ACNTS_CLOSURE_DATE <'30-JUN-2021'-- Reimbursement Voucher posted on
       AND ACNTS_CLOSURE_DATE > '20-AUG-2020'; --minmum date of acblkcovid implementation
