/*
SELECT IACLINK_ACTUAL_ACNUM,SBCAIA_BRN_CODE    ,
SBCAIA_CR_DB_INT_FLG    ,
SBCAIA_DATE_OF_ENTRY ,   
SBCAIA_DAY_SL     FROM SBCAIA , ACTUAL_ACCOUNT_UPDATE
WHERE SBCAIA_ENTITY_NUM = 1
AND SBCAIA_INTERNAL_ACNUM = IACLINK_INTERNAL_ACNUM
GROUP BY IACLINK_ACTUAL_ACNUM ,SBCAIA_BRN_CODE    ,
SBCAIA_CR_DB_INT_FLG    ,
SBCAIA_DATE_OF_ENTRY ,   
SBCAIA_DAY_SL 
HAVING COUNT(*) > 1

*/






-- SBCAIA

CREATE TABLE SBCAIA_ACTUAL_AC
AS
   SELECT *
     FROM SBCAIA
    WHERE     SBCAIA_ENTITY_NUM = 1
          AND SBCAIA_INTERNAL_ACNUM IN
                 (SELECT IACLINK_INTERNAL_ACNUM FROM ACTUAL_ACCOUNT_UPDATE);


DECLARE
   V_COUNT    NUMBER := 0;
   V_AC_NUM   NUMBER;
BEGIN
   FOR IDX
      IN (  SELECT * FROM ACTUAL_ACCOUNT_UPDATE)
   LOOP
      IF IDX.SL = 1
      THEN
         V_AC_NUM := IDX.IACLINK_INTERNAL_ACNUM;
      END IF;

      UPDATE SBCAIA
         SET SBCAIA_INTERNAL_ACNUM = V_AC_NUM
       WHERE     SBCAIA_ENTITY_NUM = 1
             AND SBCAIA_INTERNAL_ACNUM = IDX.IACLINK_INTERNAL_ACNUM;
   END LOOP;
END;


-- SBCAIABRK


CREATE TABLE SBCAIABRK_ACTUAL_AC
AS
   SELECT *
     FROM SBCAIABRK
    WHERE     SBCAIBRK_ENTITY_NUM = 1
          AND SBCAIBRK_INTERNAL_ACNUM IN
                 (SELECT IACLINK_INTERNAL_ACNUM FROM ACTUAL_ACCOUNT_UPDATE);

DECLARE
   V_COUNT    NUMBER := 0;
   V_AC_NUM   NUMBER;
BEGIN
   FOR IDX
      IN (  SELECT * FROM ACTUAL_ACCOUNT_UPDATE)
   LOOP
      IF IDX.SL = 1
      THEN
         V_AC_NUM := IDX.IACLINK_INTERNAL_ACNUM;
      END IF;

      UPDATE SBCAIABRK
         SET SBCAIBRK_INTERNAL_ACNUM = V_AC_NUM
       WHERE     SBCAIBRK_ENTITY_NUM = 1
             AND SBCAIBRK_INTERNAL_ACNUM = IDX.IACLINK_INTERNAL_ACNUM;
   END LOOP;
END;

